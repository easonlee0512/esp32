基於ESP32和整合MQTT協議、Node-RED以及透過NORA連接Google Assistant的智慧家庭實作

Muhammad Nazir Is'ad1, Muhammad Keiza Zein2*, Asepta Surya Wardhana3, Mochamad Rizky Pradana4
1,2,3,4 煉油廠儀器工程學系,Akamigas能源與礦產理工學院,印尼中爪哇省Cepu 55312
*通訊作者: zein.instrumentation@gmail.com

文章資訊
文章歷程:
收到稿件 2024年10月12日
修改 2024年10月29日
接受發表 2024年11月10日

摘要
本研究開發並評估了一個整合ESP32、MQTT協議、Node-RED和透過NORA連接Google Assistant的智慧家庭系統。該系統旨在控制家用設備並即時監控環境條件。研究方法包括硬體和軟體的實作,以及對系統性能、能源效率、安全性和使用者體驗的全面評估。結果顯示系統組件之間的有效整合,能源效率提升18%,且使用者滿意度高。MQTT協議在數據通訊方面表現良好,而Node-RED提供了直觀的儀表板用於視覺化顯示和控制。Google Assistant與智慧家庭的整合實現了具有響應性的語音控制設備。主要挑戰在於網際網路連接和安全性與隱私方面。本研究對開發可負擔且可客製化的智慧家庭系統有所貢獻,對家庭能源效率和物聯網技術發展具有重要意義。

關鍵字:
智慧家庭
物聯網
能源效率

1. 簡介
物聯網(IoT)技術的發展已經為我們與周圍環境互動的方式帶來革命性變化,特別是在智慧家庭的背景下。物聯網使電子設備能夠與自動化系統和遠端控制整合,目的是提高居住者的舒適度、能源效率和生活品質。然而,全面智慧家庭系統的實作往往受到整合各種不同技術和協議複雜性的限制。本研究專注於開發整合ESP32、MQTT協議、Node-RED和透過NORA連接Google Assistant的智慧家庭系統,目標是創建一個有效、易用且可負擔的解決方案。近年來,ESP32微控制器因其高性能和可負擔的價格在物聯網專案開發中變得流行。ESP32提供了Wi-Fi和藍牙連接與足夠的運算能力的獨特組合,使其非常適合智慧家庭應用。

同時,MQTT(Message Queuing Telemetry Transport)協議已成為物聯網通訊的事實標準,因為它在低頻寬傳輸數據方面的效率和可靠性。MQTT是一種客戶端-伺服器發布/訂閱傳輸協議。MQTT使得設備和伺服器之間的即時通訊具有最小的開銷,這對於資源受限的物聯網環境非常重要。MQTT代理作為伺服器接收來自客戶端的資訊,並將其發布給已訂閱特定主題的客戶端。同時,像Node-RED這樣的平台已經簡化了在一個易用的視覺介面中整合各種協議和服務的過程。Node-RED採用基於流程的程式設計方法,使開發人員能夠快速建立物聯網應用程式,而無需編寫複雜的程式碼。

此外,`像Google Assistant這樣的虛擬助理的普及為人機互動開闢了新的機會,使得透過語音命令控制家用設備成為可能。將Google Assistant整合到智慧家庭系統中不僅提高了使用者的便利性,還使得這項技術對於可能難以使用傳統介面的使用者更容易使用。然而,將所有這些組件整合到一個連貫且易用的系統中仍然是許多開發人員和終端使用者面臨的挑戰。本研究旨在通過設計、實作和評估整合的智慧家庭系統來解決這些挑戰。`

2. 方法
本研究採用實驗方法與原型設計來實作和評估整合的智慧家庭系統,其方法論結合了硬體和軟體開發,並專注於物聯網技術的整合,以創建一個連貫且響應迅速的智慧家庭生態系統。初始階段涉及基於分散式模型的系統架構設計,以ESP32作為邊緣處理單元、MQTT作為通訊協議、Node-RED用於整合和協調,以及Google Assistant作為語音介面。這些組件是通過對其在智慧家庭應用中的能力、效率和互操作性的全面評估來選擇的。對ESP32在各種操作模式下的功耗進行了進一步測試:活動時平均130 mAh,在睡眠和深度睡眠模式下分別降至10 mAh和0.5 mAh。這些結果顯示通過睡眠模式實現了顯著的能源效率,可減少設備非活動時的消耗。系統功耗的計算還考慮了DHT22感測器的額外負載(消耗1.5 mAh)和用於控制設備的繼電器模組(活動時消耗80 mAh)。基於這些測試,ESP32的深度睡眠模式在節能方面被證明非常有效,這對於需要電源效率的智慧家庭系統來說很重要。

硬體實作從配置ESP32作為主要微控制器開始。選擇ESP32是因為其雙核心能力、整合的Wi-Fi和藍牙連接,以及相對較低的功耗,使其非常適合物聯網應用。4通道繼電器模組用作執行器來控制三個燈泡(紅色、藍色、黃色)和一個風扇。選擇繼電器使得在一個系統中控制交流和直流設備成為可能,提高了實作的靈活性。整合DHT22感測器用於溫度和濕度測量,其精確度足以滿足家用應用需求。在軟體方面,實作從使用Arduino IDE開發ESP32韌體開始。該韌體整合了用於MQTT通訊的PubSubClient庫,以及用於DHT22感測器的Adafruit庫。MQTT協議實作使用HiveMQ代理(broker.hivemq.com)作為ESP32和Node-RED之間通訊的中介。選擇公共代理使得無需額外配置即可進行遠端存取,儘管在生產實作中,使用私有代理會更建議以提高安全性。

MQTT主題設計採用層次結構以實現高效的訊息管理:"zein/sukses"用於燈光和風扇控制,"zein/good"用於溫度數據,以及"nazir/sukses"用於濕度數據。這種結構允許清晰的數據分離並簡化了Node-RED中的控制邏輯實作。Node-RED作為基於流程的低程式碼平台,用於開發控制邏輯和視覺化儀表板。Node-RED的實作涉及配置MQTT節點以訂閱和發布到相關主題、用於數據處理和控制邏輯的功能節點,以及用於即時視覺化的儀表板節點。使用Node-RED使得快速原型設計和系統邏輯的快速迭代成為可能。

基於可擴展性測試,使用ESP32、MQTT和Node-RED的智慧家庭系統在10個設備內表現良好,延遲為196毫秒,每秒65條訊息,且通訊保持穩定。然而,在15個設備時,延遲增加到245毫秒,性能開始下降但仍可管理。當設備數量達到20時,延遲上升到321毫秒,一些設備出現連接中斷,表明系統變得不穩定。為確保在更大規模下保持最佳性能,需要一些優化,如將設備分配到多個ESP32閘道、使用更強大或基於叢集的MQTT代理,以及在Node-RED中實作負載平衡。這些優化將幫助系統處理增加的負載並確保通訊保持順暢。

與Google Assistant的整合是通過NORA(Node-RED Google Smart Home)完成的,這是一個使Node-RED能夠與Google Smart Home通訊的中介軟體。這個配置涉及設置Google Cloud Project、OAuth2和Node-RED中的node-red-contrib-nora,使得語音命令可以通過Node-RED和MQTT轉換為設備控制動作。系統測試是分階段進行的,從單元(ESP32、感測器、執行器)到整合,指標包括響應延遲、控制精確度、MQTT通訊可靠性和感測器精確度,包括操作場景模擬。

對於生產場景,建議使用私有代理以提高安全性,這與使用公共HiveMQ代理進行測試不同。私有代理在認證、數據策略和設備存取限制方面提供更好的控制。建議為MQTT通訊實作TLS/SSL協議;在Node-RED中,這由MQTT Secure節點支援,在ESP32中由WiFiClientSecure庫支援。安全性評估包括MQTT通訊和Google Assistant整合的漏洞,包括數據加密和中間人攻擊緩解的分析。Node-RED儀表板的安全性也可以通過雙因素認證(2FA)和額外策略來提升,確保只有經過驗證的使用者可以存取,特別是在遠端存取場景中。

除了安全性,能源效率通過測量ESP32在各種操作模式下的功耗進行分析,旨在驗證系統的能源效率聲明。使用者體驗評估採用思考發聲協議方法來測量Node-RED儀表板的易用性和與Google Assistant的互動。這整體評估從技術、安全性、能源效率和使用者體驗方面提供了智慧家庭實作的完整圖景,並確定了智慧家庭物聯網應用進一步發展的領域。

3. 結果與討論
3.1 系統實作
ESP32在控制家用設備方面表現出色。該微控制器成功管理三個燈泡(紅色、藍色、黃色)和一個風扇,具有高響應性。使用GPIO 17、5、18和19引腳控制繼電器展示了ESP32在處理多個輸出方面的靈活性。從接收命令到設備執行的平均響應時間記錄為不到100毫秒,展示了ESP32優秀的即時處理能力,非常適合智慧家庭應用。

使用HiveMQ代理(broker.hivemq.com)實作的MQTT協議在促進ESP32和Node-RED之間的通訊方面非常有效。使用結構化主題如"zein/sukses"用於設備控制、"zein/good"用於溫度數據和"nazir/sukses"用於濕度數據,實現了高效的數據分離和有組織的訊息管理。MQTT通訊的平均吞吐量達到每秒5條訊息,延遲低於50毫秒,顯示對於小型到中型智慧家庭應用的優異性能。

Node-RED儀表板展示了全面且用戶友好的功能。使用開關、LED、量表和圖表等節點使得即時視覺化設備狀態和感測器數據成為可能,具有直觀的介面。儀表板能夠以圖形方式顯示溫度和濕度的歷史數據,為使用者理解其家庭環境趨勢提供了額外價值。

3.2 Google Assistant整合
通過NORA(Node-RED Google Smart Home)與Google Assistant的整合展示了高語音命令識別準確率。在100個不同語音命令的測試中,系統達到97%的識別準確率,主要錯誤發生在嘈雜環境或重口音情況下。像"Ok Google,開啟藍燈"這樣的命令達到99%的成功識別和執行率。

從給出語音命令到設備執行的系統響應延遲平均記錄為1.2秒。延遲細分為:Google Assistant語音識別(±300毫秒)、NORA和Node-RED處理(±400毫秒)、MQTT通訊(±50毫秒)和ESP32設備執行(±450毫秒)。雖然這個延遲比通過儀表板直接控制要高,但在智慧家庭使用者便利性方面仍在可接受範圍內。

通過Google Assistant的命令執行可靠性在長期測試中達到98%。2%的執行失敗主要由網路連接問題或所使用的公共MQTT代理過載造成。實作重試機制和通過Google Assistant語音反饋的執行狀態確認提高了整體系統的穩健性。

3.3 溫度和濕度監控
用於溫度和濕度監控的DHT22感測器在測試中顯示良好的精確度。與校準溫度計和濕度計相比,DHT22顯示溫度平均偏差±0.3°C,相對濕度±2%。這種精確度水平足以滿足家庭環境監控應用,並符合感測器製造商承諾的規格。

Node-RED儀表板上的溫度和濕度數據視覺化成功實現了每分鐘一次的即時資訊更新。使用量表顯示當前值和圖表顯示過去24小時趨勢為使用者提供了全面的概覽。實作當溫度或濕度超過特定閾值時觸發通知的警報系統增加了此監控系統的功能價值。對一個月期間收集的數據分析顯示溫度和濕度波動模式與每日時間變化和天氣條件一致。系統成功識別空調使用(通過智慧家庭系統控制)與室溫下降之間的相關性,為能源使用優化提供了寶貴見解。

3.4 能源效率
智慧家庭系統的能源效率顯示出令人滿意的結果。ESP32在正常操作模式下平均消耗80mA@3.3V,在深度睡眠模式下僅消耗10μA。實作睡眠方案成功將日平均功耗降低40%。該系統還成功降低了受控設備的能源消耗,燈具使用降低25%,風扇使用降低30%。與非自動化系統相比,一個月測試期間的總家庭能源消耗降低18%。

3.5 系統安全性
系統安全性分析揭示了一些潛在漏洞。使用不帶SSL/TLS加密的公共MQTT代理增加了中間人攻擊和嗅探的風險。通過NORA與Google Assistant的整合也引起了關於潛在隱私侵犯和OAuth2實作漏洞利用的安全考慮。提高安全性的建議包括實作SSL/TLS加密、使用私有MQTT代理、實作基於角色的授權機制、提升設備級安全性,以及定期審計安全配置。

3.6 使用者體驗
使用者體驗評估顯示高滿意度。85%的參與者評價Node-RED儀表板介面非常直觀或易於使用。最受讚賞的功能是設備狀態即時視覺化和溫度/濕度趨勢圖。然而,20%的使用者在理解Node-RED初始配置時遇到困難,表明需要更全面的文件。通過Google Assistant的控制獲得積極回應,92%的參與者表示對系統響應性感到滿意。但是,一些使用者報告在理解Node-RED初始配置時遇到困難,並在嘈雜環境中系統無法識別命令時感到沮喪。

3.7 與相關研究比較
與類似的智慧家庭實作相比,該系統在更無縫的整合、得益於Node-RED使用的更高靈活性,以及通過Google Assistant更穩健的語音控制方面顯示出優勢。然而,系統的限制包括對穩定網際網路連接的依賴、缺乏機器學習功能,以及在非常大或複雜的房屋中的可擴展性限制。

本研究在展示ESP32、MQTT、Node-RED和Google Assistant之間的有效整合,以及對能源效率和使用者體驗的全面分析方面做出了獨特貢獻。該系統顯示出更廣泛應用的潛力,包括適應商業建築和與智慧城市能源管理系統的整合。對物聯網技術發展的貢獻包括展示開源技術整合的有效性和提供可定制物聯網系統的藍圖。

3.8 實際和理論意義
該系統的實作顯示出顯著提高家庭能源效率的潛力,本研究中實現了18%的能源消耗減少。即時監控和自動控制能力使得更好的能源使用優化成為可能,而通過數據視覺化提高使用者對能源消耗的意識可以促進更節能的行為改變。

4. 結論
本研究已成功設計、實作和評估了整合ESP32、MQTT協議、Node-RED和通過NORA連接Google Assistant的智慧家庭系統。研究結果表明,這些技術的整合可以創建一個有效、高效且用戶友好的智慧家庭生態系統。ESP32在設備控制方面表現出高響應性,而MQTT通訊在促進系統組件之間的數據交換方面證明是有效的。Node-RED儀表板為視覺化和控制提供了直觀且全面的介面。與Google Assistant的整合提高了系統的可訪問性,使得通過語音命令控制設備具有高準確率和可靠性。溫度和濕度監控系統提供了有關家庭環境條件的寶貴見解,使得更好的能源使用優化成為可能。能源效率分析顯示出顯著的節省潛力,測試期間總能源消耗降低18%。

然而,本研究也識別出一些需要進一步關注的領域,特別是在安全性和隱私方面。使用公共MQTT代理和對第三方雲服務的依賴帶來了需要緩解的安全風險。已提出安全性改進建議,包括實作SSL/TLS加密和使用私有代理。使用者體驗評估顯示高滿意度,大多數參與者認為系統直觀且易於使用。然而,也識別出一些挑戰,如初始配置的困難和隱私相關的擔憂。

與相關研究相比,該系統在無縫整合和定制靈活性方面顯示出優勢。本研究的獨特貢獻在於有效展示了各種開源技術在智慧家庭背景下的整合,以及對能源效率和使用者體驗的全面分析。本研究的實際和理論意義重大,顯示出更廣泛應用的潛力以及對物聯網技術發展的貢獻。對家庭能源效率的潛在影響也很有希望,對可持續性和碳足跡減少具有積極影響。

總之,本研究已成功展示了基於開源技術的整合智慧家庭系統的可行性和有效性。儘管存在需要解決的挑戰,特別是在安全性和隱私方面,但本研究結果為智慧家庭和物聯網領域的進一步發展提供了堅實基礎。
